<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>order page</title>
    <link href="css/bootstrap.css" rel='stylesheet' type='text/css'/>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery.min.js"></script>
    <!-- Custom Theme files -->
    <link href="css/style.css" rel="stylesheet" type="text/css" media="all"/>
    <!-- Custom Theme files -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="application/x-javascript"> addEventListener("load", function () {
        setTimeout(hideURLbar, 0);
    }, false);

    function hideURLbar() {
        window.scrollTo(0, 1);
    } </script>
    <!--webfont-->
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic'
          rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Lobster+Two:400,400italic,700,700italic' rel='stylesheet'
          type='text/css'>
    <!--Animation-->
    <script src="js/wow.min.js"></script>
    <link href="css/animate.css" rel='stylesheet' type='text/css'/>
    <script>
        new WOW().init();
    </script>
    <script type="text/javascript" src="js/move-top.js"></script>
    <script type="text/javascript" src="js/easing.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(function ($) {
            $(".scroll").click(function (event) {
                event.preventDefault();
                $('html,body').animate({scrollTop: $(this.hash).offset().top}, 1200);
            });
        });
    </script>
    <script src="js/jquery.carouFredSel-6.1.0-packed.js"></script>
    <script src="js/tms-0.4.1.js"></script>
    <script>
        $(window).load(function () {
            $('.slider')._TMS({
                show: 0,
                pauseOnHover: false,
                prevBu: '.prev',
                nextBu: '.next',
                playBu: false,
                duration: 800,
                preset: 'fade',
                pagination: true,//'.pagination',true,'<ul></ul>'
                pagNums: false,
                slideshow: 8000,
                numStatus: false,
                banners: false,
                waitBannerAnimation: false,
                progressBar: false
            })
        });

        $(window).load(
            function () {
                $('.carousel1').carouFredSel({
                    auto: false, prev: '.prev', next: '.next', width: 960, items: {
                        visible: {
                            min: 1,
                            max: 4
                        },
                        height: 'auto',
                        width: 240,

                    }, responsive: false,

                    scroll: 1,

                    mousewheel: false,

                    swipe: {onMouse: false, onTouch: false}
                });


            });

    </script>
    <script src="js/jquery.easydropdown.js"></script>
    <style>
        .row1 {
            display: table;
            margin: auto;
        }

        .div {
            display: table-cell;

        }

        .wow swing animated {
            display: table-cell;
        }

        .order-number {
            margin-left: 10px;
            margin-right: 40px;
        }

        .dropdown-content {
            height: 28px;
            width: 250px;
            margin-left: 10px;
            margin-right: 15px;
        }

        .rows th {
            text-align: center;
        }

        .btns {
            border-radius: 3px;
            border: 1px solid rgb(236, 151, 31);
            width: 80px;
            height: 40px;
            background-color: rgb(236, 151, 31);
            color: white;
        }

        .p-btn, .c-btn, .v-btn {
            background-color: rgb(51, 122, 183);
            border: 1px solid rgb(51, 122, 183);
            color: white;
            width: 80px;
            height: 30px;
            border-radius: 3px;
        }

        .pageNum, .totalNum {
            color: red;
            font-size: 25px;
        }

        .row {
            margin-top: 50px;
        }

        .menu div {
            position: absolute;
            top: 0;
            height: 60px;
            font-family: microsoft yahei
        }

        .menu .all-sort a {
            color: #fff;
            display: block;
            width: 100%;
            height: 100%;
            line-height: 40px
        }

        .menu .nav ul li {
            float: left;
            width: 85px;
            line-height: 40px
        }

        .menu .nav ul li a {
            display: block;
            width: 100%;
            color: #fff;
            text-align: center;
            font: 700 15px / 40px "Microsoft Yahei"
        }

        .menu .nav ul li a:hover, .menu .nav ul li a.current {
            background: #a40000;
            text-decoration: none
        }

        .nav_top a, .nav_top a:hover {
            color: #323232;
            font: 14px / 40px "Microsoft Yahei";
            text-decoration: none;
            padding: 0 15px;
            display: block;
            font-weight: bold;
        }

        .nav_top ul {
            width: 1200px;
            margin: 0 auto;
        }

        .nav_top ul li {
            float: left;
            text-align: center;
            position: relative;
        }

        .nav_top ul li.all {
            width: 200px;
            margin-right: 17px;
            _display: inline;
            text-align: left;
            background: #ff2832;
            position: relative;
        }

        .nav_top ul li.all a, .nav_top ul li.all a:hover {
            padding: 0 0 0 20px;
            display: block;
            width: 171px;
            background: no-repeat 161px -567px;
            color: #fff;
        }

        .nav_top ul li a:hover {
            display: block;
            color: #ff2832;
        }

        .narrow_page .nav_top ul {
            width: 960px;
        }

        .nav_top ul li.all a:hover {
            background: no-repeat 161px -567px;
        }

        ul {
            list-style: none;
        }

        .storey container {
            margin-top: 30px;
        }

    </style>
</head>
<body>
<!-- header-section-starts -->
<div class="header">
    <div class="container">
        <div class="top-header">
            <div class="logo">
                <a href="index.html"><img style="width: 110px" src="images/logo.png" class="img-responsive" alt=""/></a>
            </div>
            <div class="queries">
                <p>Questions? Call us <span>8888-8888 </span><label>(9AM to 11PM)</label></p>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
    <div class="menu-bar">
        <div class="container">
            <div class="top-menu">
                <ul>
                    <li><a href="index.html">首页</a></li>
                    |
                    <li><a href="popular-restaurents.html">点餐</a></li>
                    |
                    <li><a href="contact.html">购物车</a></li>
                    |
                    <li class="active"><a href="Order.html">订单</a></li>
                    <div class="clearfix"></div>
                </ul>
            </div>
            <div class="login-section">
                <ul>
                    <li><a href="login.html">登录</a></li>
                    |
                    <li><a href="register.html">注册</a></li>
                    |
                    <li><a href="#">帮助</a></li>
                    <div class="clearfix"></div>
                </ul>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
</div>
<!-- header-section-ends -->
<div class="order-section-page">
    <div class="ordering-form">
        <div class="container">
            <div class="order-form-head text-center wow bounceInLeft" data-wow-delay="0.4s">
                <h3>Restaurant Order Form</h3>
                <p>Ordering Food Was Never So Simple</p>
            </div>
            <div class="col-md-6 order-form-grids">
                <div class="order-form-grid  wow fadeInLeft" data-wow-delay="0.4s">
                    <h5>Order Information</h5>
                    <!--主体部分-->
                    <div class="container">
                        <!--搜索框-->
                        <div class="row1">
                            <div class="div">
                                <b>订单号：</b>
                                <input type="text" class="order-number" id="search-id"/>
                                <b>订单状态：</b>
                                <select name="status" class="dropdown-content" id="select-status">
                                    <option class="orders" value="5">全部订单</option>
                                    <option value="0" class="orders">待付款</option>
                                    <option value="3" class="orders">已付款</option>
                                    <option value="1" class="orders">已发货</option>
                                    <option value="4" class="orders">已退款</option>
                                </select>
                            </div>
                            <div class="wow swing animated" data-wow-delay="0.4s">
                                <input type="button" value="搜索" id="btn_search" class="btns"/>
                            </div>
                        </div>
                        <br>
                        <br>
                        <!--表格-->
                        <div class="row">
                            <div class="col-md-12">
                                <table class="table table-hover" id="tab" style="text-align: center;" border="1px">
                                    <tr class="rows">
                                        <th colspan="2">美食信息</th>
                                        <th>数量</th>
                                        <th>单价（元）</th>
                                        <th>状态</th>
                                        <th>操作</th>
                                    </tr>
                                    <tbody id="items" style="text-align: center">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!--&lt;!&ndash;分页&ndash;&gt;-->
                        <!--<div class="row">-->
                            <!--&lt;!&ndash;分页文字信息&ndash;&gt;-->
                            <!--<div class="col-md-6">-->
                                <!--<i></i><b>共</b>-->
                                <!--<span id="totalPage" class="pageNum">12</span><b>页</b><span id="totalCount" class="totalNum">100</span><b>条</b>-->
                            <!--</div>-->
                            <!--&lt;!&ndash;分页条信息&ndash;&gt;-->
                            <!--<div class="page">-->
                                <!--<nav aria-label="Page navigation">-->
                                    <!--<ul class="pagination">-->
                                        <!--<li><a href="#">首页</a></li>-->
                                        <!--<li>-->
                                            <!--<a href="#" aria-label="Previous">-->
                                                <!--<span aria-hidden="true">&laquo;</span>-->
                                            <!--</a>-->
                                        <!--</li>-->
                                        <!--<li><a href="#">1</a></li>-->
                                        <!--<li><a href="#">2</a></li>-->
                                        <!--<li><a href="#">3</a></li>-->
                                        <!--<li><a href="#">4</a></li>-->
                                        <!--<li><a href="#">5</a></li>-->
                                        <!--<li>-->
                                            <!--<a href="#" aria-label="Next">-->
                                                <!--<span aria-hidden="true">&raquo;</span>-->
                                            <!--</a>-->
                                        <!--</li>-->
                                        <!--<li><a href="#">末页</a></li>-->
                                    <!--</ul>-->
                                <!--</nav>-->
                            <!--</div>-->
                        <!--</div>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="special-offers-section">
        <div class="container">
            <div class="special-offers-section-head text-center dotted-line">
                <h4>Special Offers</h4>
            </div>
            <div class="special-offers-section-grids">
                <div class="m_3"><span class="middle-dotted-line"> </span></div>
                <div class="container">
                    <ul id="flexiselDemo3">
                        <li>
                            <div class="offer">
                                <div class="offer-image">
                                    <img src="images/p1.jpg" class="img-responsive" alt=""/>
                                </div>
                                <div class="offer-text">
                                    <h4>Olister Combo pack lorem</h4>
                                    <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. </p>
                                    <input type="button" value="Grab It">
                                    <span></span>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </li>
                        <li>
                            <div class="offer">
                                <div class="offer-image">
                                    <img src="images/p2.jpg" class="img-responsive" alt=""/>
                                </div>
                                <div class="offer-text">
                                    <h4>Chicken Jumbo pack lorem</h4>
                                    <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. </p>
                                    <input type="button" value="Grab It">
                                    <span></span>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </li>
                        <li>
                            <div class="offer">
                                <div class="offer-image">
                                    <img src="images/p3.jpg" class="img-responsive" alt=""/>
                                </div>
                                <div class="offer-text">
                                    <h4>Crab Combo pack lorem</h4>
                                    <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. </p>
                                    <input type="button" value="Grab It">
                                    <span></span>
                                </div>

                                <div class="clearfix"></div>
                            </div>
                        </li>
                        <li>
                            <div class="offer">
                                <div class="offer-image">
                                    <img src="images/p2.jpg" class="img-responsive" alt=""/>
                                </div>
                                <div class="offer-text">
                                    <h4>Chicken Jumbo pack lorem</h4>
                                    <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. </p>
                                    <input type="button" value="Grab It">
                                    <span></span>
                                </div>

                                <div class="clearfix"></div>
                            </div>
                        </li>
                    </ul>
                    <script type="text/javascript">
                        $(window).load(function () {

                            $("#flexiselDemo3").flexisel({
                                visibleItems: 3,
                                animationSpeed: 1000,
                                autoPlay: true,
                                autoPlaySpeed: 3000,
                                pauseOnHover: true,
                                enableResponsiveBreakpoints: true,
                                responsiveBreakpoints: {
                                    portrait: {
                                        changePoint: 480,
                                        visibleItems: 1
                                    },
                                    landscape: {
                                        changePoint: 640,
                                        visibleItems: 2
                                    },
                                    tablet: {
                                        changePoint: 768,
                                        visibleItems: 3
                                    }
                                }
                            });

                        });
                    </script>
                    <script type="text/javascript" src="js/jquery.flexisel.js"></script>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- footer-section-starts -->
<div class="footer">
    <div class="container">
        <p class="wow fadeInLeft" data-wow-delay="0.4s">Copyright &copy; 2020.Loving HUBU All rights reserved. More
            imformation <a href="http://www.hubu.edu.cn/" target="_blank" title="Loving HUBU">Loving HUBU</a> - please
            click <a
                    href="http://www.hubu.edu.cn/" title="Loving HUBU" target="_blank">HUBU JAVA</a></p>
    </div>
</div>
<!-- footer-section-ends -->
<script type="text/javascript">
    baseUrl = "http://123.57.18.175:8081/api";
    var status = {"0": "待付款", "1": "已发货", "2": "订单撤销", "3": "订单完成", "4": "订单失败"};
    //显示订单数据
    $.ajax({
        url: baseUrl + "/orderInfo/list",
        type: "GET",
        dataType: "json",
        contentType: "application/json;charset=utf-8",
        xhrFields: {
            withCredentials: true
        },
        crossDomain: true,
        success: function (data) {
            data1 = data.data;
            load(data1);
            //console.log(data1);
        }
    });

    function load(data) {
        for (var i = 0; i < data.length; i++) {
            var tr = $("<tr></tr>")
            var td1 = $("<td colspan='2'></td>").addClass("eachorder");
            td1 = td1.append(data[i].orderInfoId);
            var td2 = $("<td></td>").append(data[i].orderInfoNum);
            var td3 = $("<td></td>").append(data[i].orderInfoPrice);
            var td4 = $("<td></td>").addClass("st");
            if (data[i].orderInfoStatus == 0) {
                var td4 = $("<td></td>").append("待付款");
                var input = $("<input />").attr("type", "button").attr("value", "付款").addClass("p-btn");
                var span = $("<span></span>").append(input);
                var td5 = $("<td></td>").append(span);
            } else if (data[i].orderInfoStatus == 3) {
                var td4 = $("<td></td>").append("已付款");
                var input = $("<input />").attr("type", "button").attr("value", "退款").addClass("v-btn");
                var span = $("<span></span>").append(input);
                var td5 = $("<td></td>").append(span);
            } else {
                if (data[i].orderInfoStatus == 1) {
                    var td4 = $("<td></td>").append("已发货");
                } else if (data[i].orderInfoStatus == 2) {
                    var td4 = $("<td></td>").append("已退款");
                } else {
                    var td4 = $("<td></td>").append("已退款");
                }
                var input = $("<input />").attr("type", "button").attr("value", "查看详情").addClass("c-btn");
                var span = $("<span></span>").append(input);
                var td5 = $("<td></td>").append(span);
            }
            tr.append(td1);
            tr.append(td2);
            tr.append(td3);
            tr.append(td4);
            tr.append(td5);
            $("#items").append(tr);
        }

        //付款
        $(".p-btn").bind("click", function () {
            var orderInfoId = $(this).parent().parent().siblings(".eachorder").text();
            var a = confirm("确定付款吗？");
            //console.log(orderInfoId);
            if (a == true) {
                $.ajax({
                    url: baseUrl + "/orderInfo/update?orderInfoId=" + orderInfoId + "&orderInfoStatus=3",
                    type: "GET",
                    dataType: "json",
                    contentType: "application/json;charset=utf-8",
                    xhrFields: {
                        withCredentials: true
                    },
                    crossDomain: true,
                    success: function (res) {
                        if (res.code == 0) {
                            alert("付款成功！");
                            $(this).val("退款");
                            $(this).removeClass('p-btn').addClass('v-btn');
                            var newtext = "已付款";
                            $(this).parent().siblings('.st').html(newtext);
                            window.location.reload();
                        } else {
                            alert("失败！");
                        }
                    }
                });
            }
        });

        //撤销
        $(".v-btn").bind("click", function () {
            var orderInfoId = $(this).parent().parent().siblings(".eachorder").text();
            var a = confirm("确定退款吗？");
            //console.log(orderInfoId);
            if (a == true) {
                $.ajax({
                    url: baseUrl + "/orderInfo/update?orderInfoId=" + orderInfoId + "&orderInfoStatus=4",
                    type: "GET",
                    dataType: "json",
                    contentType: "application/json;charset=utf-8",
                    xhrFields: {
                        withCredentials: true
                    },
                    crossDomain: true,
                    success: function (res) {
                        if (res.code == 0) {
                            $(this).val("查看详情");
                            $(this).removeClass('v-btn').addClass('c-btn');
                            var newtext = "已退款";
                            $(this).parent().siblings('.st').html(newtext);
                            window.location.reload();
                        } else {
                            alert("失败！");
                        }
                    }
                });
            }
        });

        //查看详情
        $(".c-btn").bind("click", function () {
            window.location.href = "book.html"
        })
    }

    $(function () {
        //根据id点击按钮查询
        $("#btn_search").click(function () {
            //订单id
            var orderInfoId = $("#search-id").val();
            //根据商品状态查询
            var orderInfoStatus = $("#select-status option:selected").val();
            console.log(orderInfoStatus);
            if (orderInfoStatus != "5") {
                $.ajax({
                    url: baseUrl + "/orderInfo/list?orderInfoId" + orderInfoId + "&orderInfoStatus=" + orderInfoStatus,
                    type: "GET",
                    dataType: "json",
                    contentType: "application/json;charset=utf-8",
                    xhrFields: {
                        withCredentials: true
                    },
                    crossDomain: true,
                    success: function (data) {
                        var data2 = new Array();
                        data2[0] = data.data;
                        console.log(data2[0]);
                        // debugger
                        $("#items").remove();
                        var items = document.createElement("tbody");
                        items.setAttribute("id", "items");
                        $("#tab").append(items);
                        load(data2[0]);
                    }
                });
            } else {
                //跳转路径
                window.location.href = "orderInfo.html";
            }
        });
    });
</script>
<script type="text/javascript">
    $(document).ready(function () {
        /*
        var defaults = {
              containerID: 'toTop', // fading element id
            containerHoverID: 'toTopHover', // fading element hover id
            scrollSpeed: 1200,
            easingType: 'linear'
         };
        */

        $().UItoTop({easingType: 'easeOutQuart'});

    });
</script>
<a href="#" id="toTop" style="display: block;"> <span id="toTopHover" style="opacity: 1;"> </span></a>


</body>
</html>